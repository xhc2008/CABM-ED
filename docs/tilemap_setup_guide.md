# TileMap 设置指南

## 在 Godot 编辑器中设置 TileSet

### 步骤 1: 准备 TileMapLayer 节点
1. 在场景树中选中你创建的 `TileMapLayer` 节点
2. 在检查器（Inspector）中找到 `Tile Set` 属性
3. 点击 `[empty]` 下拉菜单，选择 `New TileSet`

### 步骤 2: 导入 Tileset 图片
1. 点击刚创建的 TileSet 资源，底部会打开 TileSet 编辑器
2. 在 TileSet 编辑器左侧，点击 `+` 按钮
3. 选择 `Atlas` (图集模式)
4. 在右侧 `Texture` 属性中，拖入你的 tileset 图片
5. 设置 `Texture Region Size`（每个 tile 的尺寸，如 32x32 或 64x64）

### 步骤 3: 批量设置碰撞箱（重要！）- Godot 4.x 版本

#### 第一步：添加物理层（Physics Layer）
1. 在 TileSet 编辑器底部，找到 **"Setup"** 标签页（或叫 "TileSet" 标签）
2. 在左侧面板找到 **"Physics Layers"** 部分
3. 点击 `+` 按钮添加一个物理层（Physics Layer 0）
4. 这一步很重要，没有物理层就无法添加碰撞！

#### 第二步：选择要编辑的 Tile
1. 切换到 **"Select"** 标签页（在底部工具栏）
2. 在中间的 Atlas 预览区域，点击选择一个或多个 tile
   - 单击：选择单个 tile
   - `Ctrl+点击`：多选
   - `Shift+拖拽`：框选多个
   - `Ctrl+A`：全选所有 tile

#### 第三步：切换到物理编辑模式
1. 选中 tile 后，在底部工具栏找到 **"Physics"** 标签页
2. 点击切换到物理编辑模式
3. 在右侧会看到 **"Physics Layer 0"** 的选项

#### 第四步：添加碰撞形状
现在你应该能看到绘制工具了！在 tile 预览区域的**上方工具栏**：

**工具栏图标（从左到右）：**
- 🔲 **矩形工具** - 点击后在 tile 上拖拽绘制矩形碰撞箱
- 🔺 **多边形工具** - 点击多个点创建多边形碰撞箱
- ✏️ **编辑工具** - 编辑已有的碰撞形状
- 🗑️ **删除工具** - 删除碰撞形状

**快速添加矩形碰撞（最常用）：**
1. 选中要添加碰撞的 tile
2. 点击 **矩形工具** 图标（正方形图标）
3. 在 tile 预览区域，从左上角拖拽到右下角
4. 松开鼠标，碰撞箱就创建好了

**批量添加碰撞的技巧：**
1. 先选中所有需要碰撞的 tile（如所有墙壁）
2. 切换到 Physics 标签
3. 使用矩形工具在**第一个 tile** 上绘制碰撞箱
4. 这个碰撞箱会**自动应用到所有选中的 tile**！

#### 方法 B: 使用自动生成（适合复杂形状）
1. 选中 tile
2. 切换到 Physics 标签
3. 在右侧面板找到一个小按钮（可能显示为工具图标）
4. 寻找 **"Create Collision Polygon"** 或类似选项
5. Godot 会根据图片的不透明区域自动生成碰撞形状

#### 常见问题：找不到工具？

**如果看不到绘制工具：**
1. ✅ 确认已经添加了 Physics Layer（在 Setup 标签）
2. ✅ 确认已经选中了至少一个 tile
3. ✅ 确认切换到了 **Physics** 标签（不是 Select 标签）
4. ✅ 工具栏在 tile 预览区域的**正上方**，不是侧边栏

**界面布局参考：**
```
┌─────────────────────────────────────────┐
│ [Setup] [Select] [Paint] [Physics] ... │ ← 底部标签页
├─────────────────────────────────────────┤
│ 左侧：Atlas列表 │ 中间：Tile预览       │
│                 │ ▲这里上方有工具栏    │
│                 │ [🔲][🔺][✏️][🗑️]    │
│                 │                       │
│                 │ 右侧：属性面板        │
│                 │ Physics Layer 0       │
└─────────────────────────────────────────┘
```

### 步骤 4: 绘制地图
1. 关闭 TileSet 编辑器（点击底部的 `TileMap` 标签）
2. 在场景编辑器中，选择 TileMapLayer 节点
3. 底部会显示 TileMap 编辑器
4. 选择要绘制的 tile
5. 在场景视图中点击绘制

### 步骤 5: 设置图层和碰撞层
1. 选中 TileMapLayer 节点
2. 在 Inspector 中找到 `Collision` 部分
3. 设置 `Collision Layer` 和 `Collision Mask`
   - Layer: 这个 TileMap 所在的层（如 Layer 1 = 环境）
   - Mask: 这个 TileMap 会与哪些层碰撞

## 快速技巧

### 批量操作快捷键
- `Ctrl+A`: 全选所有 tile
- `Shift+点击`: 多选 tile
- `Ctrl+点击`: 添加/移除选择

### 常用工具
- **画笔工具**: 单个绘制
- **填充工具**: 填充区域
- **矩形工具**: 绘制矩形区域
- **橡皮擦**: 删除 tile

### 推荐的 Tile 分类
```
地板类（无碰撞）:
- 草地、石板、木板、泥土等

墙壁类（完整碰撞）:
- 石墙、木墙、栅栏等

装饰类（根据需要）:
- 花草（无碰撞）
- 树木（有碰撞）
- 石头（有碰撞）
```

## 临时测试方案（如果还没有素材）

### 使用纯色方块测试
1. 创建一个简单的 32x32 图片，包含几个不同颜色的方块
2. 在图片编辑器中：
   - 第一个方块：绿色（草地）
   - 第二个方块：灰色（石板）
   - 第三个方块：棕色（墙壁）
3. 导入到 Godot 作为 tileset
4. 为墙壁方块添加碰撞箱

### 在线获取免费 Tileset
- [OpenGameArt.org](https://opengameart.org/)
- [itch.io](https://itch.io/game-assets/free/tag-tileset)
- 搜索关键词: "free tileset 32x32" 或 "free pixel art tileset"

## 常见问题

### Q: 找不到绘制碰撞箱的工具？
A: 按顺序检查：
1. ✅ 在 **Setup** 标签中添加了 Physics Layer
2. ✅ 在 **Select** 标签中选中了 tile
3. ✅ 切换到了 **Physics** 标签
4. ✅ 工具栏在 tile 预览区域的**正上方**（不是侧边栏）
5. ✅ 如果还是看不到，尝试调整编辑器窗口大小

### Q: 玩家穿过墙壁？
A: 检查：
1. TileSet 中是否正确设置了碰撞箱（Physics 标签中能看到蓝色/绿色的碰撞形状）
2. TileMapLayer 的 Collision Layer 是否正确（Inspector 中）
3. 玩家的 Collision Mask 是否包含 TileMap 的 Layer
4. 在场景运行时按 F4 查看碰撞形状是否显示

### Q: 如何修改已有的碰撞箱？
A: 
1. 点击 TileSet 资源打开编辑器
2. 在 Select 标签选择要修改的 tile
3. 切换到 Physics 标签
4. 点击编辑工具（铅笔图标）
5. 拖动碰撞形状的顶点来调整

### Q: 如何批量添加相同的碰撞箱？
A: 
1. 在 Select 标签中，按住 `Ctrl` 或 `Shift` 多选 tile
2. 切换到 Physics 标签
3. 在**任意一个选中的 tile** 上绘制碰撞箱
4. 碰撞箱会自动应用到所有选中的 tile

### Q: 如何删除碰撞箱？
A:
1. 选中 tile，切换到 Physics 标签
2. 点击删除工具（垃圾桶图标）
3. 点击要删除的碰撞形状

### Q: 如何查看碰撞箱是否生效？
A:
1. 运行游戏（F5）
2. 在运行时按 **F4** 键
3. 会显示所有碰撞形状（蓝色轮廓）
4. 如果看不到碰撞形状，说明没有正确设置
