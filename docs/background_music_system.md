# èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿ

## æ¦‚è¿°
èƒŒæ™¯éŸ³ä¹ç³»ç»Ÿå…è®¸ç©å®¶ç®¡ç†æ¸¸æˆä¸­çš„èƒŒæ™¯éŸ³ä¹å’Œç¯å¢ƒéŸ³ï¼ŒåŒ…æ‹¬åˆ‡æ¢éŸ³ä¹ã€ä¸Šä¼ è‡ªå®šä¹‰éŸ³é¢‘æ–‡ä»¶ä»¥åŠè°ƒèŠ‚éŸ³é‡ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. éŸ³ä¹æ’­æ”¾å™¨å…¥å£
- åœ¨ä¹¦æˆ¿åœºæ™¯ï¼ˆstudyroomï¼‰ä¸­æœ‰ä¸€ä¸ª**éšè—çš„å¯ç‚¹å‡»åŒºåŸŸ**
- ç‚¹å‡»è¯¥åŒºåŸŸåä¼šå¼¹å‡º"ğŸµ èƒŒæ™¯éŸ³ä¹"æŒ‰é’®ï¼ˆå¸¦åŠ¨ç”»æ•ˆæœï¼‰
- ç‚¹å‡»æŒ‰é’®æ‰“å¼€éŸ³ä¹æ’­æ”¾å™¨é¢æ¿
- å†æ¬¡ç‚¹å‡»åŒºåŸŸæˆ–ç‚¹å‡»å¤–éƒ¨å¯å…³é—­æŒ‰é’®èœå•

### 2. åˆ‡æ¢éŸ³ä¹é€‰é¡¹å¡
- **å†…ç½®éŸ³ä¹åˆ—è¡¨**ï¼šè‡ªåŠ¨åŠ è½½ `assets/audio/BGM/` ç›®å½•ä¸‹çš„æ‰€æœ‰éŸ³é¢‘æ–‡ä»¶
- **è‡ªå®šä¹‰éŸ³ä¹**ï¼šæ˜¾ç¤ºç©å®¶ä¸Šä¼ çš„è‡ªå®šä¹‰éŸ³é¢‘æ–‡ä»¶ï¼ˆæ ‡è®°ä¸º"[è‡ªå®šä¹‰]"ï¼‰
- **æ’­æ”¾éŸ³ä¹**ï¼šç‚¹å‡»åˆ—è¡¨ä¸­çš„éŸ³ä¹é¡¹å³å¯æ’­æ”¾
- **ä¸Šä¼ éŸ³ä¹**ï¼šç‚¹å‡»"ä¸Šä¼ éŸ³ä¹"æŒ‰é’®ï¼Œé€‰æ‹©æœ¬åœ°éŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒ MP3ã€OGGã€WAV æ ¼å¼ï¼‰
- **åˆ é™¤éŸ³ä¹**ï¼šé€‰ä¸­è‡ªå®šä¹‰éŸ³ä¹åï¼Œç‚¹å‡»"åˆ é™¤é€‰ä¸­"æŒ‰é’®å¯åˆ é™¤è¯¥æ–‡ä»¶

### 3. éŸ³é‡è°ƒèŠ‚é€‰é¡¹å¡
- **èƒŒæ™¯éŸ³ä¹éŸ³é‡**ï¼šç‹¬ç«‹è°ƒèŠ‚BGMéŸ³é‡ï¼ˆ0-100%ï¼‰
- **ç¯å¢ƒéŸ³éŸ³é‡**ï¼šç‹¬ç«‹è°ƒèŠ‚ç¯å¢ƒéŸ³æ•ˆéŸ³é‡ï¼ˆ0-100%ï¼‰
- éŸ³é‡è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜åˆ°é…ç½®æ–‡ä»¶

## æ–‡ä»¶ç»“æ„

### åœºæ™¯æ–‡ä»¶
- `scenes/music_button.tscn` - éŸ³ä¹æ’­æ”¾å™¨å…¥å£ï¼ˆéšè—ç‚¹å‡»åŒºåŸŸï¼‰
- `scenes/music_player_panel.tscn` - éŸ³ä¹æ’­æ”¾å™¨é¢æ¿UI

### è„šæœ¬æ–‡ä»¶
- `scripts/music_button.gd` - å…¥å£æŒ‰é’®é€»è¾‘ï¼ˆå‚è€ƒæ—¥è®°æŒ‰é’®è®¾è®¡ï¼‰
- `scripts/music_player_panel.gd` - æ’­æ”¾å™¨é¢æ¿é€»è¾‘
- `scripts/audio_manager.gd` - éŸ³é¢‘ç®¡ç†å™¨ï¼ˆå·²æ‰©å±•ï¼‰
- `scripts/main.gd` - ä¸»åœºæ™¯é€»è¾‘ï¼ˆå·²æ·»åŠ éŸ³ä¹æŒ‰é’®æ”¯æŒï¼‰

### é…ç½®æ–‡ä»¶
- `config/interactive_elements.json` - å¯äº¤äº’å…ƒç´ é…ç½®ï¼ˆåŒ…å«music_buttonï¼‰
- `config/audio_config.json` - éŸ³é¢‘é…ç½®ï¼ˆåŒ…å«éŸ³é‡è®¾ç½®ï¼‰

### éŸ³é¢‘ç›®å½•
- `assets/audio/BGM/` - å†…ç½®èƒŒæ™¯éŸ³ä¹ç›®å½•
- `user://custom_bgm/` - è‡ªå®šä¹‰éŸ³ä¹ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰

## é…ç½®è¯´æ˜

### äº¤äº’å…ƒç´ é…ç½®
åœ¨ `config/interactive_elements.json` ä¸­é…ç½®éŸ³ä¹æŒ‰é’®ï¼š

```json
{
  "elements": {
    "music_button": {
      "name": "éŸ³ä¹æ’­æ”¾å™¨å…¥å£",
      "type": "click_area",
      "size": {
        "width": 200,
        "height": 150
      },
      "position": {
        "anchor": "bottom_left",
        "offset_x": 160,
        "offset_y": -150
      },
      "scenes": ["studyroom"],
      "enabled": true
    }
  }
}
```

### éŸ³é¢‘é…ç½®
åœ¨ `config/audio_config.json` ä¸­é…ç½®éŸ³é‡ï¼š

```json
{
  "volume": {
    "background_music": 0.3,
    "ambient": 0.3
  }
}
```

## API è¯´æ˜

### AudioManager æ–°å¢æ–¹æ³•

#### `play_custom_bgm(file_path: String)`
æ’­æ”¾è‡ªå®šä¹‰BGMæ–‡ä»¶
- å‚æ•°ï¼šéŸ³é¢‘æ–‡ä»¶è·¯å¾„ï¼ˆæ”¯æŒèµ„æºè·¯å¾„å’Œç”¨æˆ·è·¯å¾„ï¼‰
- æ’­æ”¾è‡ªå®šä¹‰BGMæ—¶ä¼šæš‚åœåœºæ™¯éŸ³ä¹çš„è‡ªåŠ¨åˆ‡æ¢

#### `stop_custom_bgm()`
åœæ­¢è‡ªå®šä¹‰BGMï¼Œæ¢å¤åœºæ™¯éŸ³ä¹

#### `set_ambient_volume(volume: float)`
è®¾ç½®ç¯å¢ƒéŸ³éŸ³é‡
- å‚æ•°ï¼šéŸ³é‡å€¼ï¼ˆ0.0 - 1.0ï¼‰

#### `get_ambient_volume() -> float`
è·å–ç¯å¢ƒéŸ³éŸ³é‡
- è¿”å›ï¼šéŸ³é‡å€¼ï¼ˆ0.0 - 1.0ï¼‰

#### `play_ambient_sound(file_path: String, loop: bool = true)`
æ’­æ”¾ç¯å¢ƒéŸ³
- å‚æ•°ï¼š
  - `file_path`ï¼šéŸ³é¢‘æ–‡ä»¶è·¯å¾„
  - `loop`ï¼šæ˜¯å¦å¾ªç¯æ’­æ”¾ï¼ˆé»˜è®¤trueï¼‰

#### `stop_ambient_sound()`
åœæ­¢ç¯å¢ƒéŸ³æ’­æ”¾

## ä½¿ç”¨ç¤ºä¾‹

### åœ¨ä»£ç ä¸­æ’­æ”¾è‡ªå®šä¹‰BGM
```gdscript
var audio_manager = get_node("/root/Main/AudioManager")
audio_manager.play_custom_bgm("user://custom_bgm/my_music.mp3")
```

### è°ƒèŠ‚éŸ³é‡
```gdscript
var audio_manager = get_node("/root/Main/AudioManager")
audio_manager.set_bgm_volume(0.5)  # 50%éŸ³é‡
audio_manager.set_ambient_volume(0.3)  # 30%éŸ³é‡
```

### æ’­æ”¾ç¯å¢ƒéŸ³
```gdscript
var audio_manager = get_node("/root/Main/AudioManager")
audio_manager.play_ambient_sound("res://assets/audio/rain.mp3", true)
```

## æ³¨æ„äº‹é¡¹

1. **éŸ³é¢‘æ ¼å¼æ”¯æŒ**ï¼š
   - **OGG**ï¼šâœ… æ¨èä½¿ç”¨ï¼ŒGodotåŸç”Ÿå®Œç¾æ”¯æŒï¼Œæ–‡ä»¶å°ï¼Œè´¨é‡å¥½
   - **WAV**ï¼šâœ… åŸç”Ÿæ”¯æŒï¼Œä½†æ–‡ä»¶è¾ƒå¤§ï¼Œé€‚åˆçŸ­éŸ³æ•ˆ
   - **MP3**ï¼šâœ… åŸç”Ÿæ”¯æŒï¼Œéœ€è¦åœ¨å¯¼å…¥æ—¶æ­£ç¡®é…ç½®
   - **AAC/M4A**ï¼šâš ï¸ Godot 4 åŸç”Ÿä¸æ”¯æŒï¼Œéœ€è¦è½¬æ¢æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶
   
   **AAC æ ¼å¼å¤„ç†æ–¹æ¡ˆ**ï¼š
   - æ–¹æ¡ˆ1ï¼šä½¿ç”¨ FFmpeg è½¬æ¢ä¸º OGG æ ¼å¼ï¼ˆæ¨èï¼‰
     ```bash
     ffmpeg -i input.aac -c:a libvorbis -q:a 5 output.ogg
     ```
   - æ–¹æ¡ˆ2ï¼šè½¬æ¢ä¸º MP3 æ ¼å¼
     ```bash
     ffmpeg -i input.aac -c:a libmp3lame -b:a 192k output.mp3
     ```
   - æ–¹æ¡ˆ3ï¼šä½¿ç”¨ Godot æ’ä»¶ï¼ˆå¦‚æœæœ‰å¯ç”¨çš„ AAC è§£ç æ’ä»¶ï¼‰

2. **è‡ªå®šä¹‰éŸ³ä¹å­˜å‚¨**ï¼š
   - è‡ªå®šä¹‰éŸ³ä¹ä¿å­˜åœ¨ `user://custom_bgm/` ç›®å½•
   - Windows: `%APPDATA%\Godot\app_userdata\[é¡¹ç›®å]\custom_bgm\`
   - Linux: `~/.local/share/godot/app_userdata/[é¡¹ç›®å]/custom_bgm/`
   - macOS: `~/Library/Application Support/Godot/app_userdata/[é¡¹ç›®å]/custom_bgm/`

3. **æ€§èƒ½è€ƒè™‘**ï¼š
   - å¤§å‹éŸ³é¢‘æ–‡ä»¶å¯èƒ½å½±å“åŠ è½½é€Ÿåº¦
   - å»ºè®®å‹ç¼©éŸ³é¢‘æ–‡ä»¶ä»¥å‡å°ä½“ç§¯

4. **åœºæ™¯åˆ‡æ¢**ï¼š
   - æ’­æ”¾è‡ªå®šä¹‰BGMæ—¶ï¼Œåœºæ™¯åˆ‡æ¢ä¸ä¼šè‡ªåŠ¨æ›´æ¢éŸ³ä¹
   - éœ€è¦æ‰‹åŠ¨åœæ­¢è‡ªå®šä¹‰BGMæ‰èƒ½æ¢å¤åœºæ™¯éŸ³ä¹

## éŸ³é¢‘æ ¼å¼å¿«é€Ÿå‚è€ƒ

| æ ¼å¼ | æ”¯æŒçŠ¶æ€ | æ–‡ä»¶å¤§å° | éŸ³è´¨ | æ¨èåº¦ | è¯´æ˜ |
|------|---------|---------|------|--------|------|
| OGG  | âœ… å®Œç¾æ”¯æŒ | å° | ä¼˜ç§€ | â­â­â­â­â­ | æœ€æ¨èï¼Œå¼€æºæ ¼å¼ |
| MP3  | âœ… åŸç”Ÿæ”¯æŒ | å° | è‰¯å¥½ | â­â­â­â­ | é€šç”¨æ ¼å¼ |
| WAV  | âœ… åŸç”Ÿæ”¯æŒ | å¤§ | æ— æŸ | â­â­â­ | é€‚åˆçŸ­éŸ³æ•ˆ |
| AAC  | âŒ ä¸æ”¯æŒ | å° | ä¼˜ç§€ | â­ | éœ€è¦è½¬æ¢ |
| M4A  | âŒ ä¸æ”¯æŒ | å° | ä¼˜ç§€ | â­ | éœ€è¦è½¬æ¢ |

### AAC è½¬æ¢å‘½ä»¤é€ŸæŸ¥

```bash
# è½¬æ¢ä¸º OGGï¼ˆæ¨èï¼Œè´¨é‡æœ€å¥½ï¼‰
ffmpeg -i input.aac -c:a libvorbis -q:a 5 output.ogg

# è½¬æ¢ä¸º MP3ï¼ˆå…¼å®¹æ€§å¥½ï¼‰
ffmpeg -i input.aac -c:a libmp3lame -b:a 192k output.mp3

# æ‰¹é‡è½¬æ¢ï¼ˆWindows PowerShellï¼‰
Get-ChildItem *.aac | ForEach-Object { ffmpeg -i $_.Name -c:a libvorbis -q:a 5 "$($_.BaseName).ogg" }

# æ‰¹é‡è½¬æ¢ï¼ˆLinux/Macï¼‰
for file in *.aac; do ffmpeg -i "$file" -c:a libvorbis -q:a 5 "${file%.aac}.ogg"; done
```

## æ‰©å±•å»ºè®®

1. **æ’­æ”¾åˆ—è¡¨åŠŸèƒ½**ï¼šæ·»åŠ é¡ºåºæ’­æ”¾ã€éšæœºæ’­æ”¾ç­‰åŠŸèƒ½
2. **éŸ³ä¹ä¿¡æ¯æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå½“å‰æ’­æ”¾çš„éŸ³ä¹åç§°å’Œè¿›åº¦
3. **æ·¡å…¥æ·¡å‡ºæ•ˆæœ**ï¼šéŸ³ä¹åˆ‡æ¢æ—¶æ·»åŠ å¹³æ»‘è¿‡æ¸¡
4. **æ”¶è—åŠŸèƒ½**ï¼šå…è®¸ç©å®¶æ ‡è®°å–œæ¬¢çš„éŸ³ä¹
5. **éŸ³ä¹åˆ†ç±»**ï¼šæŒ‰ç±»å‹ã€åœºæ™¯ç­‰åˆ†ç±»ç®¡ç†éŸ³ä¹
6. **æ ¼å¼è‡ªåŠ¨è½¬æ¢**ï¼šé›†æˆéŸ³é¢‘è½¬æ¢å·¥å…·ï¼Œè‡ªåŠ¨è½¬æ¢ä¸æ”¯æŒçš„æ ¼å¼
