#!/usr/bin/env python
import os
import sys

# 获取 godot-cpp 路径（基于项目根）
godot_cpp_path = "../../godot-cpp"
if not os.path.exists(godot_cpp_path):
    print("错误: 找不到 godot-cpp，请确保它在项目根目录")
    sys.exit(1)

env = SConscript(godot_cpp_path + "/SConstruct")

# 添加源文件路径和 cppjieba 库路径
env.Append(CPPPATH=["src/", "lib/"])  # 只需要 lib/ 目录
sources = Glob("src/*.cpp")

# 构建共享库
if env["platform"] == "macos":
    library = env.SharedLibrary(
        "bin/libjieba.{}.{}.framework/libjieba.{}.{}".format(
            env["platform"], env["target"], env["platform"], env["target"]
        ),
        source=sources,
    )
else:
    library = env.SharedLibrary(
        "bin/libjieba{}{}".format(env["suffix"], env["SHLIBSUFFIX"]),
        source=sources,
    )

Default(library)